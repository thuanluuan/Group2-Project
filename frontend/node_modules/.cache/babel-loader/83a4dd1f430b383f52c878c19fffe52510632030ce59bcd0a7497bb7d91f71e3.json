{"ast":null,"code":"import _objectSpread from\"D:/New folder/Group2-Project-main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useRef,useState}from'react';import api from'../lib/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function ChangePasswordAdmin(){const[otpMsg,setOtpMsg]=useState('');const[pw,setPw]=useState({otp:'',newPassword:'',confirm:''});const[sending,setSending]=useState(false);const[submitting,setSubmitting]=useState(false);const[remaining,setRemaining]=useState(0);const timerRef=useRef(null);useEffect(()=>()=>{if(timerRef.current)clearInterval(timerRef.current);},[]);const sendOtp=async()=>{setSending(true);setOtpMsg('');try{await api.post('/auth/me/forgot-password');setOtpMsg('Đã gửi OTP đến email của bạn (2 phút).');setRemaining(120);if(timerRef.current)clearInterval(timerRef.current);timerRef.current=setInterval(()=>{setRemaining(s=>{if(s<=1){clearInterval(timerRef.current);timerRef.current=null;return 0;}return s-1;});},1000);}catch(e){var _e$response,_e$response$data;setOtpMsg((e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||'Không gửi được OTP');}finally{setSending(false);}};const submit=async e=>{e.preventDefault();setSubmitting(true);setOtpMsg('');try{if(pw.newPassword.length<6)throw new Error('Mật khẩu mới tối thiểu 6 ký tự');if(pw.newPassword!==pw.confirm)throw new Error('Xác nhận mật khẩu không khớp');await api.post('/auth/me/reset-password',{otp:pw.otp,newPassword:pw.newPassword});setOtpMsg('Đổi mật khẩu thành công');setPw({otp:'',newPassword:'',confirm:''});}catch(e){var _e$response2,_e$response2$data;setOtpMsg((e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.message)||e.message||'Đổi mật khẩu thất bại');}finally{setSubmitting(false);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{marginBottom:8,fontSize:12,opacity:0.8},children:\"Qu\\u1EA3n tr\\u1ECB \\u203A \\u0110\\u1ED5i m\\u1EADt kh\\u1EA9u\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card__header\",children:\"\\u0110\\u1ED5i m\\u1EADt kh\\u1EA9u (Admin)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card__body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",style:{gap:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"button\",onClick:sendOtp,disabled:sending,children:sending?'Đang gửi OTP...':'Gửi OTP đến email của tôi'}),remaining>0&&/*#__PURE__*/_jsxs(\"span\",{className:\"badge\",children:[\"OTP c\\xF2n: \",Math.floor(remaining/60),\":\",String(remaining%60).padStart(2,'0')]})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"form\",onSubmit:submit,style:{marginTop:12},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"OTP\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:pw.otp,onChange:e=>setPw(_objectSpread(_objectSpread({},pw),{},{otp:e.target.value})),placeholder:\"6 ch\\u1EEF s\\u1ED1\",inputMode:\"numeric\",pattern:\"^\\\\\\\\d{6}$\",title:\"Nh\\u1EADp 6 ch\\u1EEF s\\u1ED1\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"M\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"password\",value:pw.newPassword,onChange:e=>setPw(_objectSpread(_objectSpread({},pw),{},{newPassword:e.target.value})),minLength:6,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Nh\\u1EADp l\\u1EA1i m\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"password\",value:pw.confirm,onChange:e=>setPw(_objectSpread(_objectSpread({},pw),{},{confirm:e.target.value})),minLength:6,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"submit\",disabled:submitting,children:submitting?'Đang đổi...':'Đổi mật khẩu'})}),otpMsg&&/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{marginTop:8},children:otpMsg})]})]})]})]});}","map":{"version":3,"names":["useEffect","useRef","useState","api","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ChangePasswordAdmin","otpMsg","setOtpMsg","pw","setPw","otp","newPassword","confirm","sending","setSending","submitting","setSubmitting","remaining","setRemaining","timerRef","current","clearInterval","sendOtp","post","setInterval","s","e","_e$response","_e$response$data","response","data","message","submit","preventDefault","length","Error","_e$response2","_e$response2$data","children","className","style","marginBottom","fontSize","opacity","gap","type","onClick","disabled","Math","floor","String","padStart","onSubmit","marginTop","value","onChange","_objectSpread","target","placeholder","inputMode","pattern","title","required","minLength"],"sources":["D:/New folder/Group2-Project-main/frontend/src/components/ChangePasswordAdmin.jsx"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport api from '../lib/api';\n\nexport default function ChangePasswordAdmin() {\n  const [otpMsg, setOtpMsg] = useState('');\n  const [pw, setPw] = useState({ otp: '', newPassword: '', confirm: '' });\n  const [sending, setSending] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [remaining, setRemaining] = useState(0);\n  const timerRef = useRef(null);\n\n  useEffect(() => () => { if (timerRef.current) clearInterval(timerRef.current); }, []);\n\n  const sendOtp = async () => {\n    setSending(true);\n    setOtpMsg('');\n    try {\n      await api.post('/auth/me/forgot-password');\n      setOtpMsg('Đã gửi OTP đến email của bạn (2 phút).');\n      setRemaining(120);\n      if (timerRef.current) clearInterval(timerRef.current);\n      timerRef.current = setInterval(() => {\n        setRemaining((s) => {\n          if (s <= 1) { clearInterval(timerRef.current); timerRef.current = null; return 0; }\n          return s - 1;\n        });\n      }, 1000);\n    } catch (e) {\n      setOtpMsg(e?.response?.data?.message || 'Không gửi được OTP');\n    } finally {\n      setSending(false);\n    }\n  };\n\n  const submit = async (e) => {\n    e.preventDefault();\n    setSubmitting(true);\n    setOtpMsg('');\n    try {\n      if (pw.newPassword.length < 6) throw new Error('Mật khẩu mới tối thiểu 6 ký tự');\n      if (pw.newPassword !== pw.confirm) throw new Error('Xác nhận mật khẩu không khớp');\n      await api.post('/auth/me/reset-password', { otp: pw.otp, newPassword: pw.newPassword });\n      setOtpMsg('Đổi mật khẩu thành công');\n      setPw({ otp: '', newPassword: '', confirm: '' });\n    } catch (e) {\n      setOtpMsg(e?.response?.data?.message || e.message || 'Đổi mật khẩu thất bại');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <>\n      <div className=\"empty\" style={{ marginBottom: 8, fontSize: 12, opacity: 0.8 }}>\n        Quản trị › Đổi mật khẩu\n      </div>\n      <div className=\"card\">\n      <div className=\"card__header\">Đổi mật khẩu (Admin)</div>\n      <div className=\"card__body\">\n        <div className=\"row\" style={{ gap: 8 }}>\n          <button className=\"button\" type=\"button\" onClick={sendOtp} disabled={sending}>\n            {sending ? 'Đang gửi OTP...' : 'Gửi OTP đến email của tôi'}\n          </button>\n          {remaining > 0 && (\n            <span className=\"badge\">OTP còn: {Math.floor(remaining/60)}:{String(remaining%60).padStart(2,'0')}</span>\n          )}\n        </div>\n        <form className=\"form\" onSubmit={submit} style={{ marginTop: 12 }}>\n          <div className=\"field\">\n            <label className=\"label\">OTP</label>\n            <input className=\"input\" value={pw.otp} onChange={(e) => setPw({ ...pw, otp: e.target.value })} placeholder=\"6 chữ số\" inputMode=\"numeric\" pattern=\"^\\\\d{6}$\" title=\"Nhập 6 chữ số\" required />\n          </div>\n          <div className=\"field\">\n            <label className=\"label\">Mật khẩu mới</label>\n            <input className=\"input\" type=\"password\" value={pw.newPassword} onChange={(e) => setPw({ ...pw, newPassword: e.target.value })} minLength={6} required />\n          </div>\n          <div className=\"field\">\n            <label className=\"label\">Nhập lại mật khẩu mới</label>\n            <input className=\"input\" type=\"password\" value={pw.confirm} onChange={(e) => setPw({ ...pw, confirm: e.target.value })} minLength={6} required />\n          </div>\n          <div className=\"row\">\n            <button className=\"button\" type=\"submit\" disabled={submitting}>{submitting ? 'Đang đổi...' : 'Đổi mật khẩu'}</button>\n          </div>\n          {otpMsg && <div className=\"empty\" style={{ marginTop: 8 }}>{otpMsg}</div>}\n        </form>\n      </div>\n    </div>\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}