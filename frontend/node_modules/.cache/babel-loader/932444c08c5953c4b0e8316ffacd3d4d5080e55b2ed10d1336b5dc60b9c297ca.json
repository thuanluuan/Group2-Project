{"ast":null,"code":"import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\nimport api from '../lib/api';\n\n// Helpers to persist auth\nfunction saveAuth({\n  token,\n  user\n}) {\n  try {\n    if (token) localStorage.setItem('auth_token', token);\n    if (user) localStorage.setItem('auth_user', JSON.stringify(user));\n  } catch {}\n}\nfunction clearAuth() {\n  try {\n    localStorage.removeItem('auth_token');\n    localStorage.removeItem('auth_user');\n  } catch {}\n}\nexport const loginThunk = createAsyncThunk('auth/login', async ({\n  email,\n  password\n}, {\n  rejectWithValue\n}) => {\n  try {\n    var _res$data, _res$data2, _res$data3;\n    const res = await api.post('/auth/login', {\n      email,\n      password\n    });\n    const token = (res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.accessToken) || (res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : _res$data2.token);\n    const user = res === null || res === void 0 ? void 0 : (_res$data3 = res.data) === null || _res$data3 === void 0 ? void 0 : _res$data3.user;\n    if (!token || !user) throw new Error('Invalid login response');\n    saveAuth({\n      token,\n      user\n    });\n    return {\n      token,\n      user\n    };\n  } catch (err) {\n    var _err$response, _err$response2;\n    const status = err === null || err === void 0 ? void 0 : (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status;\n    const data = err === null || err === void 0 ? void 0 : (_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.data;\n    return rejectWithValue({\n      status,\n      data,\n      message: (data === null || data === void 0 ? void 0 : data.message) || (err === null || err === void 0 ? void 0 : err.message) || 'Login failed'\n    });\n  }\n});\nexport const fetchMeThunk = createAsyncThunk('auth/fetchMe', async (_, {\n  rejectWithValue\n}) => {\n  try {\n    const res = await api.get('/auth/me');\n    const user = res === null || res === void 0 ? void 0 : res.data;\n    if (!(user !== null && user !== void 0 && user._id)) throw new Error('Invalid profile response');\n    // keep token from storage\n    const token = localStorage.getItem('auth_token');\n    if (token) saveAuth({\n      token,\n      user\n    });\n    return {\n      user\n    };\n  } catch (err) {\n    var _err$response3, _err$response3$data;\n    return rejectWithValue({\n      message: (err === null || err === void 0 ? void 0 : (_err$response3 = err.response) === null || _err$response3 === void 0 ? void 0 : (_err$response3$data = _err$response3.data) === null || _err$response3$data === void 0 ? void 0 : _err$response3$data.message) || 'Failed to load profile'\n    });\n  }\n});\nconst initialState = {\n  user: null,\n  token: null,\n  status: 'idle',\n  // 'idle' | 'loading' | 'succeeded' | 'failed'\n  error: null\n};\nconst authSlice = createSlice({\n  name: 'auth',\n  initialState,\n  reducers: {\n    hydrateFromStorage(state) {\n      try {\n        const token = localStorage.getItem('auth_token');\n        const userStr = localStorage.getItem('auth_user');\n        const user = userStr ? JSON.parse(userStr) : null;\n        state.token = token || null;\n        state.user = user || null;\n        state.error = null;\n      } catch {}\n    },\n    logout(state) {\n      state.user = null;\n      state.token = null;\n      state.status = 'idle';\n      state.error = null;\n      clearAuth();\n    },\n    setAuth(state, action) {\n      const {\n        token,\n        user\n      } = action.payload || {};\n      state.token = token || null;\n      state.user = user || null;\n      saveAuth({\n        token,\n        user\n      });\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(loginThunk.pending, state => {\n      state.status = 'loading';\n      state.error = null;\n    }).addCase(loginThunk.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      state.token = action.payload.token;\n      state.user = action.payload.user;\n      state.error = null;\n    }).addCase(loginThunk.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.payload || {\n        message: 'Login failed'\n      };\n    }).addCase(fetchMeThunk.pending, state => {\n      state.status = 'loading';\n      state.error = null;\n    }).addCase(fetchMeThunk.fulfilled, (state, action) => {\n      state.status = 'succeeded';\n      state.user = action.payload.user;\n    }).addCase(fetchMeThunk.rejected, (state, action) => {\n      state.status = 'failed';\n      state.error = action.payload || {\n        message: 'Failed to load profile'\n      };\n    });\n  }\n});\nexport const {\n  hydrateFromStorage,\n  logout,\n  setAuth\n} = authSlice.actions;\n\n// Selectors\nexport const selectAuth = state => state.auth;\nexport const selectIsAuthenticated = state => !!state.auth.token;\nexport const selectUser = state => state.auth.user;\nexport const selectIsAdmin = state => {\n  var _state$auth$user;\n  return ((_state$auth$user = state.auth.user) === null || _state$auth$user === void 0 ? void 0 : _state$auth$user.role) === 'admin';\n};\nexport default authSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","api","saveAuth","token","user","localStorage","setItem","JSON","stringify","clearAuth","removeItem","loginThunk","email","password","rejectWithValue","_res$data","_res$data2","_res$data3","res","post","data","accessToken","Error","err","_err$response","_err$response2","status","response","message","fetchMeThunk","_","get","_id","getItem","_err$response3","_err$response3$data","initialState","error","authSlice","name","reducers","hydrateFromStorage","state","userStr","parse","logout","setAuth","action","payload","extraReducers","builder","addCase","pending","fulfilled","rejected","actions","selectAuth","auth","selectIsAuthenticated","selectUser","selectIsAdmin","_state$auth$user","role","reducer"],"sources":["D:/New folder/Group2-Project-main/frontend/src/store/authSlice.js"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport api from '../lib/api';\r\n\r\n// Helpers to persist auth\r\nfunction saveAuth({ token, user }) {\r\n  try {\r\n    if (token) localStorage.setItem('auth_token', token);\r\n    if (user) localStorage.setItem('auth_user', JSON.stringify(user));\r\n  } catch {}\r\n}\r\n\r\nfunction clearAuth() {\r\n  try {\r\n    localStorage.removeItem('auth_token');\r\n    localStorage.removeItem('auth_user');\r\n  } catch {}\r\n}\r\n\r\nexport const loginThunk = createAsyncThunk(\r\n  'auth/login',\r\n  async ({ email, password }, { rejectWithValue }) => {\r\n    try {\r\n      const res = await api.post('/auth/login', { email, password });\r\n      const token = res?.data?.accessToken || res?.data?.token;\r\n      const user = res?.data?.user;\r\n      if (!token || !user) throw new Error('Invalid login response');\r\n      saveAuth({ token, user });\r\n      return { token, user };\r\n    } catch (err) {\r\n      const status = err?.response?.status;\r\n      const data = err?.response?.data;\r\n      return rejectWithValue({ status, data, message: data?.message || err?.message || 'Login failed' });\r\n    }\r\n  }\r\n);\r\n\r\nexport const fetchMeThunk = createAsyncThunk(\r\n  'auth/fetchMe',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const res = await api.get('/auth/me');\r\n      const user = res?.data;\r\n      if (!user?._id) throw new Error('Invalid profile response');\r\n      // keep token from storage\r\n      const token = localStorage.getItem('auth_token');\r\n      if (token) saveAuth({ token, user });\r\n      return { user };\r\n    } catch (err) {\r\n      return rejectWithValue({ message: err?.response?.data?.message || 'Failed to load profile' });\r\n    }\r\n  }\r\n);\r\n\r\nconst initialState = {\r\n  user: null,\r\n  token: null,\r\n  status: 'idle', // 'idle' | 'loading' | 'succeeded' | 'failed'\r\n  error: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    hydrateFromStorage(state) {\r\n      try {\r\n        const token = localStorage.getItem('auth_token');\r\n        const userStr = localStorage.getItem('auth_user');\r\n        const user = userStr ? JSON.parse(userStr) : null;\r\n        state.token = token || null;\r\n        state.user = user || null;\r\n        state.error = null;\r\n      } catch {}\r\n    },\r\n    logout(state) {\r\n      state.user = null;\r\n      state.token = null;\r\n      state.status = 'idle';\r\n      state.error = null;\r\n      clearAuth();\r\n    },\r\n    setAuth(state, action) {\r\n      const { token, user } = action.payload || {};\r\n      state.token = token || null;\r\n      state.user = user || null;\r\n      saveAuth({ token, user });\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(loginThunk.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(loginThunk.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n        state.error = null;\r\n      })\r\n      .addCase(loginThunk.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload || { message: 'Login failed' };\r\n      })\r\n      .addCase(fetchMeThunk.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchMeThunk.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(fetchMeThunk.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload || { message: 'Failed to load profile' };\r\n      });\r\n  }\r\n});\r\n\r\nexport const { hydrateFromStorage, logout, setAuth } = authSlice.actions;\r\n\r\n// Selectors\r\nexport const selectAuth = (state) => state.auth;\r\nexport const selectIsAuthenticated = (state) => !!state.auth.token;\r\nexport const selectUser = (state) => state.auth.user;\r\nexport const selectIsAdmin = (state) => state.auth.user?.role === 'admin';\r\n\r\nexport default authSlice.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}