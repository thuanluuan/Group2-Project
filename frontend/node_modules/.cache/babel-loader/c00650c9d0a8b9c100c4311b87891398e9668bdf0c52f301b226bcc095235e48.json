{"ast":null,"code":"var _process$env$REACT_AP;import axios from\"axios\";const API_BASE=((_process$env$REACT_AP=process.env.REACT_APP_API_URL)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.replace(/\\/$/,\"\"))||\"\";export const api=axios.create({baseURL:API_BASE||undefined,withCredentials:false});const authApi=axios.create({baseURL:API_BASE||undefined,withCredentials:true});api.interceptors.request.use(config=>{const token=localStorage.getItem(\"auth_token\");if(token){config.headers=config.headers||{};config.headers.Authorization=\"Bearer \".concat(token);}return config;});let isRefreshing=false;let pendingQueue=[];function onRefreshed(newToken){pendingQueue.forEach(cb=>cb(newToken));pendingQueue=[];}api.interceptors.response.use(res=>res,async err=>{var _err$response;const original=err===null||err===void 0?void 0:err.config;if((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===401&&!(original!==null&&original!==void 0&&original._retry)){original._retry=true;if(!isRefreshing){isRefreshing=true;try{var _r$data,_r$data2;const r=await authApi.post('/auth/refresh');const newToken=(r===null||r===void 0?void 0:(_r$data=r.data)===null||_r$data===void 0?void 0:_r$data.accessToken)||(r===null||r===void 0?void 0:(_r$data2=r.data)===null||_r$data2===void 0?void 0:_r$data2.token);if(newToken){localStorage.setItem('auth_token',newToken);onRefreshed(newToken);}else{throw new Error('No access token');}}catch(e){try{localStorage.removeItem('auth_token');localStorage.removeItem('auth_user');}catch(_unused){}isRefreshing=false;return Promise.reject(err);}isRefreshing=false;}return new Promise(resolve=>{pendingQueue.push(token=>{original.headers=original.headers||{};original.headers.Authorization=\"Bearer \".concat(token);resolve(api(original));});});}return Promise.reject(err);});export default api;","map":{"version":3,"names":["axios","API_BASE","_process$env$REACT_AP","process","env","REACT_APP_API_URL","replace","api","create","baseURL","undefined","withCredentials","authApi","interceptors","request","use","config","token","localStorage","getItem","headers","Authorization","concat","isRefreshing","pendingQueue","onRefreshed","newToken","forEach","cb","response","res","err","_err$response","original","status","_retry","_r$data","_r$data2","r","post","data","accessToken","setItem","Error","e","removeItem","_unused","Promise","reject","resolve","push"],"sources":["D:/New folder/Group2-Project-main/frontend/src/lib/api.js"],"sourcesContent":["import axios from \"axios\";\n\nconst API_BASE = process.env.REACT_APP_API_URL?.replace(/\\/$/, \"\") || \"\";\n\nexport const api = axios.create({ baseURL: API_BASE || undefined, withCredentials: false });\nconst authApi = axios.create({ baseURL: API_BASE || undefined, withCredentials: true });\n\napi.interceptors.request.use((config) => {\n  const token = localStorage.getItem(\"auth_token\");\n  if (token) {\n    config.headers = config.headers || {};\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\nlet isRefreshing = false;\nlet pendingQueue = [];\n\nfunction onRefreshed(newToken) {\n  pendingQueue.forEach((cb) => cb(newToken));\n  pendingQueue = [];\n}\n\napi.interceptors.response.use(\n  (res) => res,\n  async (err) => {\n    const original = err?.config;\n    if (err?.response?.status === 401 && !original?._retry) {\n      original._retry = true;\n      if (!isRefreshing) {\n        isRefreshing = true;\n        try {\n          const r = await authApi.post('/auth/refresh');\n          const newToken = r?.data?.accessToken || r?.data?.token;\n          if (newToken) {\n            localStorage.setItem('auth_token', newToken);\n            onRefreshed(newToken);\n          } else {\n            throw new Error('No access token');\n          }\n        } catch (e) {\n          try {\n            localStorage.removeItem('auth_token');\n            localStorage.removeItem('auth_user');\n          } catch {}\n          isRefreshing = false;\n          return Promise.reject(err);\n        }\n        isRefreshing = false;\n      }\n      return new Promise((resolve) => {\n        pendingQueue.push((token) => {\n          original.headers = original.headers || {};\n          original.headers.Authorization = `Bearer ${token}`;\n          resolve(api(original));\n        });\n      });\n    }\n    return Promise.reject(err);\n  }\n);\n\nexport default api;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}