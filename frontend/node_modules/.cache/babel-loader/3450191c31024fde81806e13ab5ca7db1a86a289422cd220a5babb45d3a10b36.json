{"ast":null,"code":"import{createAsyncThunk,createSlice}from'@reduxjs/toolkit';import api from'../lib/api';// Helpers to persist auth\nfunction saveAuth(_ref){let{token,user}=_ref;try{if(token)localStorage.setItem('auth_token',token);if(user)localStorage.setItem('auth_user',JSON.stringify(user));}catch(_unused){}}function clearAuth(){try{localStorage.removeItem('auth_token');localStorage.removeItem('auth_user');}catch(_unused2){}}export const loginThunk=createAsyncThunk('auth/login',async(_ref2,_ref3)=>{let{email,password}=_ref2;let{rejectWithValue}=_ref3;try{var _res$data,_res$data2,_res$data3;const res=await api.post('/auth/login',{email,password});const token=(res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.accessToken)||(res===null||res===void 0?void 0:(_res$data2=res.data)===null||_res$data2===void 0?void 0:_res$data2.token);const user=res===null||res===void 0?void 0:(_res$data3=res.data)===null||_res$data3===void 0?void 0:_res$data3.user;if(!token||!user)throw new Error('Invalid login response');saveAuth({token,user});return{token,user};}catch(err){var _err$response,_err$response2;const status=err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status;const data=err===null||err===void 0?void 0:(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data;return rejectWithValue({status,data,message:(data===null||data===void 0?void 0:data.message)||(err===null||err===void 0?void 0:err.message)||'Login failed'});}});export const fetchMeThunk=createAsyncThunk('auth/fetchMe',async(_,_ref4)=>{let{rejectWithValue}=_ref4;try{const res=await api.get('/auth/me');const user=res===null||res===void 0?void 0:res.data;if(!(user!==null&&user!==void 0&&user._id))throw new Error('Invalid profile response');// keep token from storage\nconst token=localStorage.getItem('auth_token');if(token)saveAuth({token,user});return{user};}catch(err){var _err$response3,_err$response3$data;return rejectWithValue({message:(err===null||err===void 0?void 0:(_err$response3=err.response)===null||_err$response3===void 0?void 0:(_err$response3$data=_err$response3.data)===null||_err$response3$data===void 0?void 0:_err$response3$data.message)||'Failed to load profile'});}});const initialState={user:null,token:null,status:'idle',// 'idle' | 'loading' | 'succeeded' | 'failed'\nerror:null};const authSlice=createSlice({name:'auth',initialState,reducers:{hydrateFromStorage(state){try{const token=localStorage.getItem('auth_token');const userStr=localStorage.getItem('auth_user');const user=userStr?JSON.parse(userStr):null;state.token=token||null;state.user=user||null;state.error=null;}catch(_unused3){}},logout(state){state.user=null;state.token=null;state.status='idle';state.error=null;clearAuth();},setAuth(state,action){const{token,user}=action.payload||{};state.token=token||null;state.user=user||null;saveAuth({token,user});}},extraReducers:builder=>{builder.addCase(loginThunk.pending,state=>{state.status='loading';state.error=null;}).addCase(loginThunk.fulfilled,(state,action)=>{state.status='succeeded';state.token=action.payload.token;state.user=action.payload.user;state.error=null;}).addCase(loginThunk.rejected,(state,action)=>{state.status='failed';state.error=action.payload||{message:'Login failed'};}).addCase(fetchMeThunk.pending,state=>{state.status='loading';state.error=null;}).addCase(fetchMeThunk.fulfilled,(state,action)=>{state.status='succeeded';state.user=action.payload.user;}).addCase(fetchMeThunk.rejected,(state,action)=>{state.status='failed';state.error=action.payload||{message:'Failed to load profile'};});}});export const{hydrateFromStorage,logout,setAuth}=authSlice.actions;// Selectors\nexport const selectAuth=state=>state.auth;export const selectIsAuthenticated=state=>!!state.auth.token;export const selectUser=state=>state.auth.user;export const selectIsAdmin=state=>{var _state$auth$user;return((_state$auth$user=state.auth.user)===null||_state$auth$user===void 0?void 0:_state$auth$user.role)==='admin';};export default authSlice.reducer;","map":{"version":3,"names":["createAsyncThunk","createSlice","api","saveAuth","_ref","token","user","localStorage","setItem","JSON","stringify","_unused","clearAuth","removeItem","_unused2","loginThunk","_ref2","_ref3","email","password","rejectWithValue","_res$data","_res$data2","_res$data3","res","post","data","accessToken","Error","err","_err$response","_err$response2","status","response","message","fetchMeThunk","_","_ref4","get","_id","getItem","_err$response3","_err$response3$data","initialState","error","authSlice","name","reducers","hydrateFromStorage","state","userStr","parse","_unused3","logout","setAuth","action","payload","extraReducers","builder","addCase","pending","fulfilled","rejected","actions","selectAuth","auth","selectIsAuthenticated","selectUser","selectIsAdmin","_state$auth$user","role","reducer"],"sources":["D:/New folder/Group2-Project-main/frontend/src/store/authSlice.js"],"sourcesContent":["import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';\r\nimport api from '../lib/api';\r\n\r\n// Helpers to persist auth\r\nfunction saveAuth({ token, user }) {\r\n  try {\r\n    if (token) localStorage.setItem('auth_token', token);\r\n    if (user) localStorage.setItem('auth_user', JSON.stringify(user));\r\n  } catch {}\r\n}\r\n\r\nfunction clearAuth() {\r\n  try {\r\n    localStorage.removeItem('auth_token');\r\n    localStorage.removeItem('auth_user');\r\n  } catch {}\r\n}\r\n\r\nexport const loginThunk = createAsyncThunk(\r\n  'auth/login',\r\n  async ({ email, password }, { rejectWithValue }) => {\r\n    try {\r\n      const res = await api.post('/auth/login', { email, password });\r\n      const token = res?.data?.accessToken || res?.data?.token;\r\n      const user = res?.data?.user;\r\n      if (!token || !user) throw new Error('Invalid login response');\r\n      saveAuth({ token, user });\r\n      return { token, user };\r\n    } catch (err) {\r\n      const status = err?.response?.status;\r\n      const data = err?.response?.data;\r\n      return rejectWithValue({ status, data, message: data?.message || err?.message || 'Login failed' });\r\n    }\r\n  }\r\n);\r\n\r\nexport const fetchMeThunk = createAsyncThunk(\r\n  'auth/fetchMe',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const res = await api.get('/auth/me');\r\n      const user = res?.data;\r\n      if (!user?._id) throw new Error('Invalid profile response');\r\n      // keep token from storage\r\n      const token = localStorage.getItem('auth_token');\r\n      if (token) saveAuth({ token, user });\r\n      return { user };\r\n    } catch (err) {\r\n      return rejectWithValue({ message: err?.response?.data?.message || 'Failed to load profile' });\r\n    }\r\n  }\r\n);\r\n\r\nconst initialState = {\r\n  user: null,\r\n  token: null,\r\n  status: 'idle', // 'idle' | 'loading' | 'succeeded' | 'failed'\r\n  error: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    hydrateFromStorage(state) {\r\n      try {\r\n        const token = localStorage.getItem('auth_token');\r\n        const userStr = localStorage.getItem('auth_user');\r\n        const user = userStr ? JSON.parse(userStr) : null;\r\n        state.token = token || null;\r\n        state.user = user || null;\r\n        state.error = null;\r\n      } catch {}\r\n    },\r\n    logout(state) {\r\n      state.user = null;\r\n      state.token = null;\r\n      state.status = 'idle';\r\n      state.error = null;\r\n      clearAuth();\r\n    },\r\n    setAuth(state, action) {\r\n      const { token, user } = action.payload || {};\r\n      state.token = token || null;\r\n      state.user = user || null;\r\n      saveAuth({ token, user });\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(loginThunk.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(loginThunk.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n        state.error = null;\r\n      })\r\n      .addCase(loginThunk.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload || { message: 'Login failed' };\r\n      })\r\n      .addCase(fetchMeThunk.pending, (state) => {\r\n        state.status = 'loading';\r\n        state.error = null;\r\n      })\r\n      .addCase(fetchMeThunk.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(fetchMeThunk.rejected, (state, action) => {\r\n        state.status = 'failed';\r\n        state.error = action.payload || { message: 'Failed to load profile' };\r\n      });\r\n  }\r\n});\r\n\r\nexport const { hydrateFromStorage, logout, setAuth } = authSlice.actions;\r\n\r\n// Selectors\r\nexport const selectAuth = (state) => state.auth;\r\nexport const selectIsAuthenticated = (state) => !!state.auth.token;\r\nexport const selectUser = (state) => state.auth.user;\r\nexport const selectIsAdmin = (state) => state.auth.user?.role === 'admin';\r\n\r\nexport default authSlice.reducer;\r\n"],"mappings":"AAAA,OAASA,gBAAgB,CAAEC,WAAW,KAAQ,kBAAkB,CAChE,MAAO,CAAAC,GAAG,KAAM,YAAY,CAE5B;AACA,QAAS,CAAAC,QAAQA,CAAAC,IAAA,CAAkB,IAAjB,CAAEC,KAAK,CAAEC,IAAK,CAAC,CAAAF,IAAA,CAC/B,GAAI,CACF,GAAIC,KAAK,CAAEE,YAAY,CAACC,OAAO,CAAC,YAAY,CAAEH,KAAK,CAAC,CACpD,GAAIC,IAAI,CAAEC,YAAY,CAACC,OAAO,CAAC,WAAW,CAAEC,IAAI,CAACC,SAAS,CAACJ,IAAI,CAAC,CAAC,CACnE,CAAE,MAAAK,OAAA,CAAM,CAAC,CACX,CAEA,QAAS,CAAAC,SAASA,CAAA,CAAG,CACnB,GAAI,CACFL,YAAY,CAACM,UAAU,CAAC,YAAY,CAAC,CACrCN,YAAY,CAACM,UAAU,CAAC,WAAW,CAAC,CACtC,CAAE,MAAAC,QAAA,CAAM,CAAC,CACX,CAEA,MAAO,MAAM,CAAAC,UAAU,CAAGf,gBAAgB,CACxC,YAAY,CACZ,MAAAgB,KAAA,CAAAC,KAAA,GAAoD,IAA7C,CAAEC,KAAK,CAAEC,QAAS,CAAC,CAAAH,KAAA,IAAE,CAAEI,eAAgB,CAAC,CAAAH,KAAA,CAC7C,GAAI,KAAAI,SAAA,CAAAC,UAAA,CAAAC,UAAA,CACF,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAtB,GAAG,CAACuB,IAAI,CAAC,aAAa,CAAE,CAAEP,KAAK,CAAEC,QAAS,CAAC,CAAC,CAC9D,KAAM,CAAAd,KAAK,CAAG,CAAAmB,GAAG,SAAHA,GAAG,kBAAAH,SAAA,CAAHG,GAAG,CAAEE,IAAI,UAAAL,SAAA,iBAATA,SAAA,CAAWM,WAAW,IAAIH,GAAG,SAAHA,GAAG,kBAAAF,UAAA,CAAHE,GAAG,CAAEE,IAAI,UAAAJ,UAAA,iBAATA,UAAA,CAAWjB,KAAK,EACxD,KAAM,CAAAC,IAAI,CAAGkB,GAAG,SAAHA,GAAG,kBAAAD,UAAA,CAAHC,GAAG,CAAEE,IAAI,UAAAH,UAAA,iBAATA,UAAA,CAAWjB,IAAI,CAC5B,GAAI,CAACD,KAAK,EAAI,CAACC,IAAI,CAAE,KAAM,IAAI,CAAAsB,KAAK,CAAC,wBAAwB,CAAC,CAC9DzB,QAAQ,CAAC,CAAEE,KAAK,CAAEC,IAAK,CAAC,CAAC,CACzB,MAAO,CAAED,KAAK,CAAEC,IAAK,CAAC,CACxB,CAAE,MAAOuB,GAAG,CAAE,KAAAC,aAAA,CAAAC,cAAA,CACZ,KAAM,CAAAC,MAAM,CAAGH,GAAG,SAAHA,GAAG,kBAAAC,aAAA,CAAHD,GAAG,CAAEI,QAAQ,UAAAH,aAAA,iBAAbA,aAAA,CAAeE,MAAM,CACpC,KAAM,CAAAN,IAAI,CAAGG,GAAG,SAAHA,GAAG,kBAAAE,cAAA,CAAHF,GAAG,CAAEI,QAAQ,UAAAF,cAAA,iBAAbA,cAAA,CAAeL,IAAI,CAChC,MAAO,CAAAN,eAAe,CAAC,CAAEY,MAAM,CAAEN,IAAI,CAAEQ,OAAO,CAAE,CAAAR,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEQ,OAAO,IAAIL,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEK,OAAO,GAAI,cAAe,CAAC,CAAC,CACpG,CACF,CACF,CAAC,CAED,MAAO,MAAM,CAAAC,YAAY,CAAGnC,gBAAgB,CAC1C,cAAc,CACd,MAAOoC,CAAC,CAAAC,KAAA,GAA0B,IAAxB,CAAEjB,eAAgB,CAAC,CAAAiB,KAAA,CAC3B,GAAI,CACF,KAAM,CAAAb,GAAG,CAAG,KAAM,CAAAtB,GAAG,CAACoC,GAAG,CAAC,UAAU,CAAC,CACrC,KAAM,CAAAhC,IAAI,CAAGkB,GAAG,SAAHA,GAAG,iBAAHA,GAAG,CAAEE,IAAI,CACtB,GAAI,EAACpB,IAAI,SAAJA,IAAI,WAAJA,IAAI,CAAEiC,GAAG,EAAE,KAAM,IAAI,CAAAX,KAAK,CAAC,0BAA0B,CAAC,CAC3D;AACA,KAAM,CAAAvB,KAAK,CAAGE,YAAY,CAACiC,OAAO,CAAC,YAAY,CAAC,CAChD,GAAInC,KAAK,CAAEF,QAAQ,CAAC,CAAEE,KAAK,CAAEC,IAAK,CAAC,CAAC,CACpC,MAAO,CAAEA,IAAK,CAAC,CACjB,CAAE,MAAOuB,GAAG,CAAE,KAAAY,cAAA,CAAAC,mBAAA,CACZ,MAAO,CAAAtB,eAAe,CAAC,CAAEc,OAAO,CAAE,CAAAL,GAAG,SAAHA,GAAG,kBAAAY,cAAA,CAAHZ,GAAG,CAAEI,QAAQ,UAAAQ,cAAA,kBAAAC,mBAAA,CAAbD,cAAA,CAAef,IAAI,UAAAgB,mBAAA,iBAAnBA,mBAAA,CAAqBR,OAAO,GAAI,wBAAyB,CAAC,CAAC,CAC/F,CACF,CACF,CAAC,CAED,KAAM,CAAAS,YAAY,CAAG,CACnBrC,IAAI,CAAE,IAAI,CACVD,KAAK,CAAE,IAAI,CACX2B,MAAM,CAAE,MAAM,CAAE;AAChBY,KAAK,CAAE,IACT,CAAC,CAED,KAAM,CAAAC,SAAS,CAAG5C,WAAW,CAAC,CAC5B6C,IAAI,CAAE,MAAM,CACZH,YAAY,CACZI,QAAQ,CAAE,CACRC,kBAAkBA,CAACC,KAAK,CAAE,CACxB,GAAI,CACF,KAAM,CAAA5C,KAAK,CAAGE,YAAY,CAACiC,OAAO,CAAC,YAAY,CAAC,CAChD,KAAM,CAAAU,OAAO,CAAG3C,YAAY,CAACiC,OAAO,CAAC,WAAW,CAAC,CACjD,KAAM,CAAAlC,IAAI,CAAG4C,OAAO,CAAGzC,IAAI,CAAC0C,KAAK,CAACD,OAAO,CAAC,CAAG,IAAI,CACjDD,KAAK,CAAC5C,KAAK,CAAGA,KAAK,EAAI,IAAI,CAC3B4C,KAAK,CAAC3C,IAAI,CAAGA,IAAI,EAAI,IAAI,CACzB2C,KAAK,CAACL,KAAK,CAAG,IAAI,CACpB,CAAE,MAAAQ,QAAA,CAAM,CAAC,CACX,CAAC,CACDC,MAAMA,CAACJ,KAAK,CAAE,CACZA,KAAK,CAAC3C,IAAI,CAAG,IAAI,CACjB2C,KAAK,CAAC5C,KAAK,CAAG,IAAI,CAClB4C,KAAK,CAACjB,MAAM,CAAG,MAAM,CACrBiB,KAAK,CAACL,KAAK,CAAG,IAAI,CAClBhC,SAAS,CAAC,CAAC,CACb,CAAC,CACD0C,OAAOA,CAACL,KAAK,CAAEM,MAAM,CAAE,CACrB,KAAM,CAAElD,KAAK,CAAEC,IAAK,CAAC,CAAGiD,MAAM,CAACC,OAAO,EAAI,CAAC,CAAC,CAC5CP,KAAK,CAAC5C,KAAK,CAAGA,KAAK,EAAI,IAAI,CAC3B4C,KAAK,CAAC3C,IAAI,CAAGA,IAAI,EAAI,IAAI,CACzBH,QAAQ,CAAC,CAAEE,KAAK,CAAEC,IAAK,CAAC,CAAC,CAC3B,CACF,CAAC,CACDmD,aAAa,CAAGC,OAAO,EAAK,CAC1BA,OAAO,CACJC,OAAO,CAAC5C,UAAU,CAAC6C,OAAO,CAAGX,KAAK,EAAK,CACtCA,KAAK,CAACjB,MAAM,CAAG,SAAS,CACxBiB,KAAK,CAACL,KAAK,CAAG,IAAI,CACpB,CAAC,CAAC,CACDe,OAAO,CAAC5C,UAAU,CAAC8C,SAAS,CAAE,CAACZ,KAAK,CAAEM,MAAM,GAAK,CAChDN,KAAK,CAACjB,MAAM,CAAG,WAAW,CAC1BiB,KAAK,CAAC5C,KAAK,CAAGkD,MAAM,CAACC,OAAO,CAACnD,KAAK,CAClC4C,KAAK,CAAC3C,IAAI,CAAGiD,MAAM,CAACC,OAAO,CAAClD,IAAI,CAChC2C,KAAK,CAACL,KAAK,CAAG,IAAI,CACpB,CAAC,CAAC,CACDe,OAAO,CAAC5C,UAAU,CAAC+C,QAAQ,CAAE,CAACb,KAAK,CAAEM,MAAM,GAAK,CAC/CN,KAAK,CAACjB,MAAM,CAAG,QAAQ,CACvBiB,KAAK,CAACL,KAAK,CAAGW,MAAM,CAACC,OAAO,EAAI,CAAEtB,OAAO,CAAE,cAAe,CAAC,CAC7D,CAAC,CAAC,CACDyB,OAAO,CAACxB,YAAY,CAACyB,OAAO,CAAGX,KAAK,EAAK,CACxCA,KAAK,CAACjB,MAAM,CAAG,SAAS,CACxBiB,KAAK,CAACL,KAAK,CAAG,IAAI,CACpB,CAAC,CAAC,CACDe,OAAO,CAACxB,YAAY,CAAC0B,SAAS,CAAE,CAACZ,KAAK,CAAEM,MAAM,GAAK,CAClDN,KAAK,CAACjB,MAAM,CAAG,WAAW,CAC1BiB,KAAK,CAAC3C,IAAI,CAAGiD,MAAM,CAACC,OAAO,CAAClD,IAAI,CAClC,CAAC,CAAC,CACDqD,OAAO,CAACxB,YAAY,CAAC2B,QAAQ,CAAE,CAACb,KAAK,CAAEM,MAAM,GAAK,CACjDN,KAAK,CAACjB,MAAM,CAAG,QAAQ,CACvBiB,KAAK,CAACL,KAAK,CAAGW,MAAM,CAACC,OAAO,EAAI,CAAEtB,OAAO,CAAE,wBAAyB,CAAC,CACvE,CAAC,CAAC,CACN,CACF,CAAC,CAAC,CAEF,MAAO,MAAM,CAAEc,kBAAkB,CAAEK,MAAM,CAAEC,OAAQ,CAAC,CAAGT,SAAS,CAACkB,OAAO,CAExE;AACA,MAAO,MAAM,CAAAC,UAAU,CAAIf,KAAK,EAAKA,KAAK,CAACgB,IAAI,CAC/C,MAAO,MAAM,CAAAC,qBAAqB,CAAIjB,KAAK,EAAK,CAAC,CAACA,KAAK,CAACgB,IAAI,CAAC5D,KAAK,CAClE,MAAO,MAAM,CAAA8D,UAAU,CAAIlB,KAAK,EAAKA,KAAK,CAACgB,IAAI,CAAC3D,IAAI,CACpD,MAAO,MAAM,CAAA8D,aAAa,CAAInB,KAAK,OAAAoB,gBAAA,OAAK,EAAAA,gBAAA,CAAApB,KAAK,CAACgB,IAAI,CAAC3D,IAAI,UAAA+D,gBAAA,iBAAfA,gBAAA,CAAiBC,IAAI,IAAK,OAAO,GAEzE,cAAe,CAAAzB,SAAS,CAAC0B,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}