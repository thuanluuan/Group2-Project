{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import api from\"../lib/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ResetPasswordByToken(_ref){let{defaultToken=\"\",onDone}=_ref;const[token,setToken]=useState(defaultToken);const[newPassword,setNewPassword]=useState(\"\");const[confirm,setConfirm]=useState(\"\");const[loading,setLoading]=useState(false);const[msg,setMsg]=useState(\"\");const[done,setDone]=useState(false);useEffect(()=>{if(!defaultToken){const params=new URLSearchParams(window.location.search);const t=params.get('resetToken')||params.get('token')||'';if(t)setToken(t);}},[defaultToken]);const submit=async e=>{e.preventDefault();if(!token){setMsg('Thiếu token');return;}if(!newPassword||newPassword.length<6){setMsg('Mật khẩu tối thiểu 6 ký tự');return;}if(newPassword!==confirm){setMsg('Xác nhận mật khẩu không khớp');return;}setLoading(true);setMsg(\"\");try{var _res$data;const res=await api.post(\"/auth/resetpassword/\".concat(encodeURIComponent(token)),{newPassword});setMsg((res===null||res===void 0?void 0:(_res$data=res.data)===null||_res$data===void 0?void 0:_res$data.message)||'Đặt lại mật khẩu thành công. Nhấn OK để quay lại trang đăng nhập.');setDone(true);}catch(e){var _e$response,_e$response$data;setMsg((e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||'Đặt lại mật khẩu thất bại');}finally{setLoading(false);}};if(done){return/*#__PURE__*/_jsxs(\"div\",{className:\"form\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{marginTop:8},children:msg||'Đặt lại mật khẩu thành công. Nhấn OK để quay lại trang đăng nhập.'}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"button\",onClick:()=>onDone===null||onDone===void 0?void 0:onDone(),children:\"OK\"})})]});}return/*#__PURE__*/_jsxs(\"form\",{onSubmit:submit,className:\"form\",children:[!defaultToken&&/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Token\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:token,onChange:e=>setToken(e.target.value),placeholder:\"D\\xE1n token t\\u1EEB email v\\xE0o \\u0111\\xE2y\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"M\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"password\",value:newPassword,onChange:e=>setNewPassword(e.target.value),minLength:6,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Nh\\u1EADp l\\u1EA1i m\\u1EADt kh\\u1EA9u\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",type:\"password\",value:confirm,onChange:e=>setConfirm(e.target.value),minLength:6,required:true}),newPassword&&confirm&&newPassword!==confirm&&/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{color:'#c62828',marginTop:6},children:\"M\\u1EADt kh\\u1EA9u nh\\u1EADp l\\u1EA1i kh\\xF4ng kh\\u1EDBp\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"submit\",disabled:loading,children:loading?'Đang đổi...':'Đổi mật khẩu'})}),msg&&/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{marginTop:8},children:msg})]});}","map":{"version":3,"names":["React","useEffect","useState","api","jsx","_jsx","jsxs","_jsxs","ResetPasswordByToken","_ref","defaultToken","onDone","token","setToken","newPassword","setNewPassword","confirm","setConfirm","loading","setLoading","msg","setMsg","done","setDone","params","URLSearchParams","window","location","search","t","get","submit","e","preventDefault","length","_res$data","res","post","concat","encodeURIComponent","data","message","_e$response","_e$response$data","response","className","children","style","marginTop","type","onClick","onSubmit","value","onChange","target","placeholder","minLength","required","color","disabled"],"sources":["D:/New folder/Group2-Project-main/frontend/src/components/ResetPasswordByToken.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport api from \"../lib/api\";\n\nexport default function ResetPasswordByToken({ defaultToken = \"\", onDone }) {\n  const [token, setToken] = useState(defaultToken);\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirm, setConfirm] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState(\"\");\n  const [done, setDone] = useState(false);\n\n  useEffect(() => {\n    if (!defaultToken) {\n      const params = new URLSearchParams(window.location.search);\n      const t = params.get('resetToken') || params.get('token') || '';\n      if (t) setToken(t);\n    }\n  }, [defaultToken]);\n\n  const submit = async (e) => {\n    e.preventDefault();\n    if (!token) { setMsg('Thiếu token'); return; }\n    if (!newPassword || newPassword.length < 6) { setMsg('Mật khẩu tối thiểu 6 ký tự'); return; }\n    if (newPassword !== confirm) { setMsg('Xác nhận mật khẩu không khớp'); return; }\n    setLoading(true);\n    setMsg(\"\");\n    try {\n      const res = await api.post(`/auth/resetpassword/${encodeURIComponent(token)}`, { newPassword });\n      setMsg(res?.data?.message || 'Đặt lại mật khẩu thành công. Nhấn OK để quay lại trang đăng nhập.');\n      setDone(true);\n    } catch (e) {\n      setMsg(e?.response?.data?.message || 'Đặt lại mật khẩu thất bại');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (done) {\n    return (\n      <div className=\"form\">\n        <div className=\"empty\" style={{ marginTop: 8 }}>{msg || 'Đặt lại mật khẩu thành công. Nhấn OK để quay lại trang đăng nhập.'}</div>\n        <div className=\"row\">\n          <button className=\"button\" type=\"button\" onClick={() => onDone?.()}>OK</button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <form onSubmit={submit} className=\"form\">\n      {!defaultToken && (\n        <div className=\"field\">\n          <label className=\"label\">Token</label>\n          <input className=\"input\" value={token} onChange={(e) => setToken(e.target.value)} placeholder=\"Dán token từ email vào đây\" />\n        </div>\n      )}\n      <div className=\"field\">\n        <label className=\"label\">Mật khẩu mới</label>\n        <input className=\"input\" type=\"password\" value={newPassword} onChange={(e) => setNewPassword(e.target.value)} minLength={6} required />\n      </div>\n      <div className=\"field\">\n        <label className=\"label\">Nhập lại mật khẩu</label>\n        <input className=\"input\" type=\"password\" value={confirm} onChange={(e) => setConfirm(e.target.value)} minLength={6} required />\n        {newPassword && confirm && newPassword !== confirm && (\n          <div className=\"empty\" style={{ color: '#c62828', marginTop: 6 }}>Mật khẩu nhập lại không khớp</div>\n        )}\n      </div>\n      <div className=\"row\">\n        <button className=\"button\" type=\"submit\" disabled={loading}>{loading ? 'Đang đổi...' : 'Đổi mật khẩu'}</button>\n      </div>\n      {msg && <div className=\"empty\" style={{ marginTop: 8 }}>{msg}</div>}\n    </form>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}