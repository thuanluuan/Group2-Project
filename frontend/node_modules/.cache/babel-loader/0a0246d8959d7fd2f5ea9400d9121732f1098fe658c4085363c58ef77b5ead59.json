{"ast":null,"code":"import _objectSpread from\"D:/New folder/Group2-Project-main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useEffect,useState}from'react';import api from'../lib/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ResetPassword(_ref){let{defaultEmail='',onDone}=_ref;const[form,setForm]=useState({email:defaultEmail,otp:'',newPassword:''});const[confirm,setConfirm]=useState('');const[loading,setLoading]=useState(false);const[message,setMessage]=useState('');const[remaining,setRemaining]=useState(120);// seconds for OTP validity\nconst[resending,setResending]=useState(false);const change=e=>setForm(_objectSpread(_objectSpread({},form),{},{[e.target.name]:e.target.value}));useEffect(()=>{setRemaining(120);const id=setInterval(()=>{setRemaining(s=>s>0?s-1:0);},1000);return()=>clearInterval(id);},[]);const submit=async e=>{e.preventDefault();setLoading(true);setMessage('');if(form.newPassword.length<6){setLoading(false);setMessage('Mật khẩu mới phải từ 6 ký tự trở lên');return;}if(form.newPassword!==confirm){setLoading(false);setMessage('Xác nhận mật khẩu không khớp');return;}try{await api.post('/auth/reset-password',form);setMessage('Đặt lại mật khẩu thành công.');onDone===null||onDone===void 0?void 0:onDone();}catch(err){var _err$response,_err$response$data;setMessage((err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||'Đặt lại thất bại');}finally{setLoading(false);}};const resend=async()=>{if(!form.email){setMessage('Vui lòng nhập email để gửi lại OTP');return;}setResending(true);setMessage('');try{await api.post('/auth/forgot-password',{email:form.email});setRemaining(120);setMessage('Đã gửi lại OTP. OTP có hiệu lực 2 phút.');}catch(err){var _err$response2,_err$response2$data;setMessage((err===null||err===void 0?void 0:(_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||'Gửi lại OTP thất bại');}finally{setResending(false);}};return/*#__PURE__*/_jsxs(\"form\",{onSubmit:submit,className:\"form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",name:\"email\",type:\"email\",value:form.email,onChange:change,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"OTP\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",name:\"otp\",value:form.otp,onChange:change,placeholder:\"6 k\\xFD t\\u1EF1\",inputMode:\"numeric\",pattern:\"^\\\\\\\\d{6}$\",title:\"Nh\\u1EADp 6 ch\\u1EEF s\\u1ED1\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"M\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",name:\"newPassword\",type:\"password\",value:form.newPassword,onChange:change,required:true,minLength:6})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"field\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Nh\\u1EADp l\\u1EA1i m\\u1EADt kh\\u1EA9u m\\u1EDBi\"}),/*#__PURE__*/_jsx(\"input\",{className:\"input\",name:\"confirmPassword\",type:\"password\",value:confirm,onChange:e=>setConfirm(e.target.value),required:true,minLength:6}),form.newPassword&&confirm&&form.newPassword!==confirm&&/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{color:'#c62828',marginTop:6},children:\"M\\u1EADt kh\\u1EA9u nh\\u1EADp l\\u1EA1i kh\\xF4ng kh\\u1EDBp\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"button\",{className:\"button\",type:\"submit\",disabled:loading,children:loading?'Đang xử lý...':'Đặt lại mật khẩu'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",style:{marginTop:8,gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"span\",{className:\"badge\",children:[\"OTP c\\xF2n hi\\u1EC7u l\\u1EF1c: \",Math.floor(remaining/60),\":\",String(remaining%60).padStart(2,'0')]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"button button--ghost\",onClick:resend,disabled:resending,children:resending?'Đang gửi lại...':'Gửi lại OTP'})]}),message&&/*#__PURE__*/_jsx(\"div\",{className:\"empty\",style:{marginTop:8},children:message})]});}","map":{"version":3,"names":["useEffect","useState","api","jsx","_jsx","jsxs","_jsxs","ResetPassword","_ref","defaultEmail","onDone","form","setForm","email","otp","newPassword","confirm","setConfirm","loading","setLoading","message","setMessage","remaining","setRemaining","resending","setResending","change","e","_objectSpread","target","name","value","id","setInterval","s","clearInterval","submit","preventDefault","length","post","err","_err$response","_err$response$data","response","data","resend","_err$response2","_err$response2$data","onSubmit","className","children","type","onChange","required","placeholder","inputMode","pattern","title","minLength","style","color","marginTop","disabled","gap","alignItems","Math","floor","String","padStart","onClick"],"sources":["D:/New folder/Group2-Project-main/frontend/src/components/ResetPassword.jsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport api from '../lib/api';\n\nexport default function ResetPassword({ defaultEmail = '', onDone }) {\n  const [form, setForm] = useState({ email: defaultEmail, otp: '', newPassword: '' });\n  const [confirm, setConfirm] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n  const [remaining, setRemaining] = useState(120); // seconds for OTP validity\n  const [resending, setResending] = useState(false);\n\n  const change = (e) => setForm({ ...form, [e.target.name]: e.target.value });\n\n  useEffect(() => {\n    setRemaining(120);\n    const id = setInterval(() => {\n      setRemaining((s) => (s > 0 ? s - 1 : 0));\n    }, 1000);\n    return () => clearInterval(id);\n  }, []);\n\n  const submit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n    setMessage('');\n    if (form.newPassword.length < 6) {\n      setLoading(false);\n      setMessage('Mật khẩu mới phải từ 6 ký tự trở lên');\n      return;\n    }\n    if (form.newPassword !== confirm) {\n      setLoading(false);\n      setMessage('Xác nhận mật khẩu không khớp');\n      return;\n    }\n    try {\n      await api.post('/auth/reset-password', form);\n      setMessage('Đặt lại mật khẩu thành công.');\n      onDone?.();\n    } catch (err) {\n      setMessage(err?.response?.data?.message || 'Đặt lại thất bại');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const resend = async () => {\n    if (!form.email) {\n      setMessage('Vui lòng nhập email để gửi lại OTP');\n      return;\n    }\n    setResending(true);\n    setMessage('');\n    try {\n      await api.post('/auth/forgot-password', { email: form.email });\n      setRemaining(120);\n      setMessage('Đã gửi lại OTP. OTP có hiệu lực 2 phút.');\n    } catch (err) {\n      setMessage(err?.response?.data?.message || 'Gửi lại OTP thất bại');\n    } finally {\n      setResending(false);\n    }\n  };\n\n  return (\n    <form onSubmit={submit} className=\"form\">\n      <div className=\"field\">\n        <label className=\"label\">Email</label>\n        <input className=\"input\" name=\"email\" type=\"email\" value={form.email} onChange={change} required />\n      </div>\n      <div className=\"field\">\n        <label className=\"label\">OTP</label>\n        <input className=\"input\" name=\"otp\" value={form.otp} onChange={change} placeholder=\"6 ký tự\" inputMode=\"numeric\" pattern=\"^\\\\d{6}$\" title=\"Nhập 6 chữ số\" required />\n      </div>\n      <div className=\"field\">\n        <label className=\"label\">Mật khẩu mới</label>\n        <input className=\"input\" name=\"newPassword\" type=\"password\" value={form.newPassword} onChange={change} required minLength={6} />\n      </div>\n      <div className=\"field\">\n        <label className=\"label\">Nhập lại mật khẩu mới</label>\n        <input className=\"input\" name=\"confirmPassword\" type=\"password\" value={confirm} onChange={(e) => setConfirm(e.target.value)} required minLength={6} />\n        {form.newPassword && confirm && form.newPassword !== confirm && (\n          <div className=\"empty\" style={{ color: '#c62828', marginTop: 6 }}>Mật khẩu nhập lại không khớp</div>\n        )}\n      </div>\n      <div className=\"row\">\n        <button className=\"button\" type=\"submit\" disabled={loading}>{loading ? 'Đang xử lý...' : 'Đặt lại mật khẩu'}</button>\n      </div>\n      <div className=\"row\" style={{ marginTop: 8, gap: 8, alignItems: 'center' }}>\n        <span className=\"badge\">OTP còn hiệu lực: {Math.floor(remaining / 60)}:{String(remaining % 60).padStart(2,'0')}</span>\n        <button type=\"button\" className=\"button button--ghost\" onClick={resend} disabled={resending}>\n          {resending ? 'Đang gửi lại...' : 'Gửi lại OTP'}\n        </button>\n      </div>\n      {message && <div className=\"empty\" style={{ marginTop: 8 }}>{message}</div>}\n    </form>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}